name: petBook Web Client CI

# êµ¬ë…í•  ì´ë²¤íŠ¸
on:
  workflow_dispatch:
  push:
    branches: [dev]
  pull_request:
    branches: [dev]

# jobs ë‹¨ìœ„ë¡œ ê°œë³„ ì„œë²„(ì •í™•íˆëŠ” Docker ì»¨í…Œì´ë„ˆ ë‹¨ìœ„ë¼ê³  í•œë‹¤.)ì—ì„œ ì‘ì—…ì´ ìˆ˜í–‰ëœë‹¤.
# ê° ì‘ì—…ì€ ë³‘ë ¬ë¡œ ì‹¤í–‰ ëœë‹¤ê³  í•˜ëŠ”ë°, needs: buildì™€ ê°™ì´ í‘œì‹œí•´ì„œ ê¸°ë‹¤ë¦´ ìˆ˜ë„ ìˆë‹¤.
jobs:
  problem-check:
    # Ubuntu, Windows, MacOSë¥¼ ì§€ì›í•œë‹¤.
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set Node.js 16.x
        uses: actions/setup-node@v3
        with:
          node-version: 16.x
      - name: yarn install
        uses: borales/actions-yarn@v4
        with:
          cmd: install
      - name: yarn run lint
        uses: borales/actions-yarn@v4
        with:
          cmd: lint
      - name: yarn run build
        uses: borales/actions-yarn@v4
        with:
          cmd: build
  ci-notify:
    name: Discord Notification
    runs-on: ubuntu-latest
    needs:
      - problem-check
    if: ${{ always() }}
    steps:
      - name: ci-notify
        env:
          TEST_WEBHOOK: ${{ secrets.TEST_WEBHOOK }}
        uses: nobrayner/discord-webhook@v1
        with:
          github-token: ${{ secrets.github_token }}
          discord-webhook: ${{ secrets.TEST_WEBHOOK }}
          username: "petBot"
          avatar-url: "https://cdn.discordapp.com/app-icons/1044621624864940163/87fe18353f90a7a4c275be945afc14e5.png?size=512"
          title: "${{ github.workflow }} : ${{ github.event_name }}"
          description: "ğŸš¥ ìƒíƒœ : {{STATUS}}\nğŸ” ë¡œê·¸ í™•ì¸ : ì œëª©ì„ í´ë¦­í•˜ì„¸ìš”\nğŸ•° ê±¸ë¦° ì‹œê°„ : ??"
          include-details: "false"
          color-success: "#008d62"
          color-failure: "#9b111e"
          color-cancelled: "#ffd400"
  call-cd-workflow:
    needs:
      - problem-check
      - ci-notify
    if: ${{ success() && github.event_name == 'push' }}
    uses: ./.github/workflows/petBook-Web-Client-CD.yml
    with:
      status: "Success"
    secrets:
      VERCEL_DEPLOY_TOKEN: ${{ secrets.VERCEL_DEPLOY_TOKEN }}
